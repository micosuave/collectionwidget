!function(t,e){"use strict";angular.module("adf.widget.collectionwidget",["adf.provider","firebase"]).config(["dashboardProvider",function(t){t.widget("curationwidget",{title:"Curation",description:"Build a simple interface to complex objects",templateUrl:"{widgetsPath}/collectionwidget/src/view.html",controller:"CurationWidgetCtrl",controllerAs:"curation",frameless:!1,reload:!0,titleTemplateUrl:"{widgetsPath}/collectionwidget/src/titleTemplateUrl.html",resolve:{curation:["config","$firebaseObject","$rootScope","FIREBASE_URL",function(t,e,a,i){if(t.id)return e(new Firebase(i+"content/"+t.id));var o=new Firebase(i+"content/"),n={};return o.push({name:"curation"}).then(function(i){var o=i.key();i.update({id:o,projectid:a.$stateParams.pId||"projectid",matterId:a.$stateParams.matterId||"matterId",groupId:a.$stateParams.groupId||"groupId",author:a.authData.uid||"userid",ispublished:!1,content_type:"curation",timestamp:Firebase.ServerValue.TIMESTAMP}),t.id=o;var n=e(i);return n.$bindTo($scope,"curation"),n.title="New Curation",n}),n}]},edit:{templateUrl:"{widgetsPath}/collectionwidget/src/edit.html",controller:"CurationWidgetConfigCtrl",modalSize:"sm",reload:!0}}).widget("userwidget",{title:"User",description:"Manage your user account",templateUrl:"{widgetsPath}/collectionwidget/src/user.html",controller:"UserWidgetCtrl",controllerAs:"user",frameless:!0,reload:!0,titleTemplateUrl:"{widgetsPath}/collectionwidget/src/titleTemplateUrl.html",config:{url:"https://milbank-patentphd.firebaseio.com/"},edit:{templateUrl:"{widgetsPath}/collectionwidget/src/edit.html",controller:"CollectionWidgetConfigCtrl",modalSize:"lg",reload:!0}})}]),angular.module("adf.widget.collectionwidget").constant("FIREBASE_URL","https://lexlab.firebaseio.com/").controller("CurationWidgetCtrl",["$scope","config","$firebaseObject","$firebaseArray","$firebaseAuth","FIREBASE_URL","Matter","$rootScope","Curation","CuratedItems","Collections","Collection","ROARevents",function(t,e,a,i,o,n,l,r,s,c,d,u,p){t.config=e,e.id||(e.id="");var g=s(e.id);g.$bindTo(t,"curation");var m=l(r.$stateParams.matterId);t.matter=m,t.curation_types=CURATIONTYPES,t.addcontent=function(e){var e=e;e.name=e.title;var a=c();a.$add(e).then(function(e){var a=e.key();t.curation.data.push(a),e.update({id:a,timestamp:Firebase.ServerValue.TIMESTAMP,author:r.authData.uid,accesslist:r.$stateParams.groupId,projectid:r.$stateParams.pId,matterId:r.$stateParams.matterId,curationid:t.curation.$id})})},t.addevent=function(e){angular.forEach(e,function(e,a){var i=e.name,o={};o.content_type="document",o.media=e.url.replace("/view?usp=drive_web","/preview"),o.iconUrl=e.iconUrl,o.uuid=e.id,o.name=i,o.mimeType=e.mimeType,o.file=e,o.parent=t.curation.$id;var n=o.collectionIds=new Array;n.push(t.curation.$id);var l=c();l.$add(o).then(function(e){var a=e.key();if(e.update({id:a,timestamp:Firebase.ServerValue.TIMESTAMP,author:r.authData.uid||"userid",accesslist:r.$stateParams.groupId||"groupId",projectid:r.$stateParams.pId||"projectid",matterId:r.$stateParams.matterId||"matterId",curationid:t.curation.$id,content_type:"document"}),angular.isUndefined(t.curation.data)){var i=new Array;i.push(a),angular.extend(t.curation,{data:i}),t.curation.$save()}else t.curation.data.push(a),t.curation.$save()})})},t.addById=function(e){if(angular.isUndefined(t.curation.data)){var a=new Array;a.push(e),angular.extend(t.curation,{data:a}),t.curation.$save()}else t.curation.data.push(e),t.curation.$save()},t.publish=function(e){angular.isUndefined(t.matter.curationlist)?(t.matter.curationlist=new Array,t.matter.curationlist.push(e),t.matter.$save(),t.curation.ispublished=!0):(t.matter.curationlist.push(e),t.matter.$save(),t.curation.ispublished=!0)},t.addfilehistory=function(e){var i=$stateParams.matterId,o=l(i),n=d(),r=function(){var t=new Array;return angular.forEach(e,function(e,a){t.push(e.uuid)}),t},s={name:"USSN "+t.history.APPNUM,rid:"PHD1",collectiontype:"source",box:"PhD for USSN "+t.history.APPNUM,styleClass:"success",app:t.history.APPNUM,content_type:"collection",roarlist:r},c=(n.$add(s).then(function(e){var i=e.key();e.update({id:i,timestamp:Firebase.ServerValue.TIMESTAMP,matter:$stateParams.matterId,project:$stateParams.pId}),angular.isUndefined(o.collectionlist)?(o.collectionlist=new Array,o.collectionlist.push(i),o.$save()):(o.collectionlist.push(i),o.$save()),t.newcollectionId=i;var n=a(e);return n.$bindTo(t,"allcollection"),n}),{name:"USSN "+t.history.APPNUM+"_Merits",rid:"PhD2",collectiontype:"source",box:"PhD for USSN "+t.history.APPNUM,styleClass:"danger",app:t.history.APPNUM,content_type:"collection",roarlist:r}),u=(n.$add(c).then(function(e){var i=e.key();e.update({id:i,timestamp:Firebase.ServerValue.TIMESTAMP,matter:$stateParams.matterId,project:$stateParams.pId}),angular.isUndefined(o.collectionlist)?(o.collectionlist=new Array,o.collectionlist.push(i),o.$save()):(o.collectionlist.push(i),o.$save()),t.meritscollectionId=i;var n=a(e);return n.$bindTo(t,"meritscollection"),n}),{name:"USSN "+t.history.APPNUM+"_Art",rid:"PhD3",collectiontype:"source",box:"PhD for USSN "+t.history.APPNUM,styleClass:"warning",app:t.history.APPNUM,content_type:"collection",roarlist:r}),g=(n.$add(u).then(function(e){var i=e.key();e.update({id:i,timestamp:Firebase.ServerValue.TIMESTAMP,matter:$stateParams.matterId,project:$stateParams.pId}),angular.isUndefined(o.collectionlist)?(o.collectionlist=new Array,o.collectionlist.push(i),o.$save()):(o.collectionlist.push(i),o.$save()),t.artcollectionId=i;var n=a(e);return n.$bindTo(t,"artcollection"),n}),{name:"USSN "+t.history.APPNUM+"_Ownership",rid:"PhD4",collectiontype:"source",box:"PhD for USSN "+t.history.APPNUM,styleClass:"info",app:t.history.APPNUM,content_type:"collection",roarlist:r});n.$add(g).then(function(e){var i=e.key();e.update({id:i,timestamp:Firebase.ServerValue.TIMESTAMP,matter:$stateParams.matterId,project:$stateParams.pId}),angular.isUndefined(o.collectionlist)?(o.collectionlist=new Array,o.collectionlist.push(i),o.$save()):(o.collectionlist.push(i),o.$save()),t.ownershipcollectionId=i;var n=a(e);return n.$bindTo(t,"ownership"),n}),new Array,new Array,new Array,new Array;$timeout(function(){angular.forEach(e,function(a,i){var o=a.name,n=o.slice(0,o.indexOf("-")),l=o.slice(o.indexOf("-")+1,o.indexOf("-")+11),r=o.slice(o.lastIndexOf("-")+1,o.indexOf(".pdf"));t.roarevent.content_type="document",t.roarevent.media=a.url.replace("/view?usp=drive_web","/preview"),t.roarevent.iconUrl=a.iconUrl,t.roarevent.uuid=a.id,t.roarevent.mimeType=a.mimeType,t.roarevent.description=r+"\n"+l+"\n"+n,t.roarevent.collections=[],t.roarevent.appId=n,t.roarevent.date=l,t.roarevent.rid=e.indexOf(a),t.roarevent.file=a,t.roarevent.doccode=r,t.roarevent.collections.push(t.newcollectionId),angular.forEach(APPDOCCODES,function(e,a){r===e&&(t.roarevent.styleClass="Applicant")}),angular.forEach(PTODOCCODES,function(e,a){r===e&&(t.roarevent.styleClass="PTO")}),angular.forEach(INTVDOCCODES,function(e,a){r===e&&(t.roarevent.styleClass="Interview")}),angular.forEach(NOADOCCODES,function(e,a){r===e&&(t.roarevent.styleClass="NOA")}),angular.forEach(PETDOCCODES,function(e,a){r===e&&(t.roarevent.styleClass="Petition")}),angular.forEach(DOCNAMES,function(e,a){angular.forEach(e,function(e,a){r===a&&(t.roarevent.name=e,t.roarevent.title=e)})}),angular.forEach(MERITSDOCS,function(e,a){r===e&&t.roarevent.collections.push(t.meritscollectionId)}),angular.forEach(ARTDOCS,function(e,a){r===e&&t.roarevent.collections.push(t.artcollectionId)}),angular.forEach(OWNERSHIPDOCS,function(e,a){r===e&&t.roarevent.collections.push(t.ownershipcollectionId)}),p.$add(t.roarevent).then(function(e){var a=e.key();console.log("added record with id "+a),e.update({id:a,timestamp:Firebase.ServerValue.TIMESTAMP}),t.roarevent={}})})},1e3)}}]).controller("CurationWidgetConfigCtrl",["$scope","config","$rootScope","Matter",function(t,e,a,i,o){var n=a(e.id);n.$bindTo(t,"curation"),t.curation=e;var l={newfield:"New Value"};t.addfield=function(){angular.extend(n,{newfield:l})},t.publishtomatter=function(){var t=o(i.$stateParams.matterId);if(angular.isUndefined(t.curationlist)){var a=new Array;angular.extend(t,{curationlist:a}),t.curationlist.push(e.id),t.$save()}else t.curationlist.push(e.id)}}]),angular.module("adf.widget.collectionwidget").run(["$templateCache",function(t){t.put("{widgetsPath}/collectionwidget/src/edit.html",'<form role=form><div class=form-group><div class="input-group btn btn-{{curation.styleClass}}"><div class=input-group><span class="input-group-addon btn btn-{{curation.styleClass}}" style="color: #fff;">Name:</span> <input ng-model=curation.name placeholder=Name type=text></div><div class=input-group><span class="input-group-addon btn btn-{{curation.styleClass}}" style="color: #fff;">Title:</span> <input ng-model=curation.title placeholder=Title type=text></div><div class=input-group><span class="input-group-addon btn btn-{{curation.styleClass}}" style="color: #777;">Color:</span><select ng-model=curation.styleClass class="btn btn-{{curation.styleClass}}"><option value=primary label=Blue></option><option value=info label=Cyan></option><option value=success label=Green></option><option value=warning label=Yellow></option><option value=danger label=Red></option><option value=default label=White></option><option value=flat label=Gray></option><option value=dark label=Dark></option></select></div><div class=input-group><span class="input-group-addon btn btn-{{collection.panelclass}} fa {{curation.icon}}" style="color: #fff;">Icon:</span><select ng-model=curation.icon class="btn btn-{{curation.styleClass}} fa {{curation.icon}}" ng-options="icon.value as icon.label for icon in ICONS"></select></div></div></div></form>'),t.put("{widgetsPath}/collectionwidget/src/titleTemplateUrl.html",'<h3 id={{curation.$id}} class="card-title bg-{{curation.styleClass}} curation-card"><span class="fa {{curation.icon || \'fa-ge\'}}"></span>{{curation.name || definition.title}} <a title="add widget content" ng-click=send()><i class="fa fa-send"></i></a> <span class=pull-right><a title="reload widget content" ng-if=widget.reload ng-click=reload()><i class="fa fa-refresh"></i></a> <a title="change widget location" class=adf-move ng-if=editMode><i class="glyphicon glyphicon-move"></i></a> <a title="collapse widget" ng-show="options.collapsible && !widgetState.isCollapsed" ng-click="widgetState.isCollapsed = !widgetState.isCollapsed"><i class="glyphicon glyphicon-minus"></i></a> <a title="expand widget" ng-show="options.collapsible && widgetState.isCollapsed" ng-click="widgetState.isCollapsed = !widgetState.isCollapsed"><i class="fa fa-minus fa-rotate-90"></i></a> <a title="edit widget configuration" ng-click=edit()><i class="glyphicon glyphicon-cog"></i></a> <a title="fullscreen widget" ng-click=openFullScreen() ng-show=options.maximizable><i class="glyphicon glyphicon-fullscreen"></i></a> <a title="remove widget" ng-click=remove() ng-if=editMode><i class="glyphicon glyphicon-remove"></i></a></span></h3>'),t.put("{widgetsPath}/collectionwidget/src/user.html",'<div id=loginpanelbodycontainer class=container-fluid><div class="row loginflexrow"><div ng-if=!authData class=loginform><h3><strong>Welcome, please log in</strong></h3><form id=loginForm name=loginForm ng-submit=user.login()><formgroup class=emailgroup>Email<input class=form-control type=email name=email ng-model=user.email required></formgroup><formgroup class=passwordgroup>Password <input class=form-control type=password name=password ng-model=user.password required></formgroup><br><div class=row><div class=col-xs-15></div><div class=col-xs-15><button id=submitBtn class="btn btn-primary pull-right" type=submit ng-click=user.login()>Log in</button></div></div></form><h6 class=pull-right>A Smart Desk for Lawyers, Everywhere.&#8480</h6></div></div></div>'),t.put("{widgetsPath}/collectionwidget/src/view.html",'<div class="panel panel-primary"><div class=panel-heading></div><div class=panel-body style=overflow:scroll;><tabset><tab class=ngDialogTab><tab-heading><i class="fa fa-cog"></i></tab-heading><input type=text ng-model=curation.title><select ng-model=curation.curation_type ng-options="type.value as type.label for type in curation_types"><option label></option></select><div class="card card-fancy"><input type=text ng-model=item.title><select ng-model=item.content_type><option value=image label=image></option><option value=video label=video></option><option value=note label=note></option><option value=document label=document></option><option value=collection label=collection></option><option value=curation label=curation></option><option value=draft label=draft></option><option value=link label=link></option><option label></option></select><input type=text ng-model=item.data> <button class="fa fa-plus" ng-click=addcontent(item)></button></div><li class="list-group-item card card-fancy"><input type=text ng-model=id placeholder="insert ID"> <a class="fa fa-link" ng-click=addById(id)></a></li><li class="list-group-item card card-success row" style="background:url(img/logolong.png) no-repeat;background-size:contain;"><input type=text ng-model=history.APPNUM placeholder="USSN Application #"> <button lk-google-picker on-picked=addevent class="fa fa-plus pull-right card-text">Upload</button></li></tab><tab class=ngDialogTab><tab-heading>Content List</tab-heading><ul class=list-group><li class="list-group-item card card-fancy card-rounded card-thick" ng-repeat="item in curation.data" ffbase={{item}}><tabset><tab heading=settings><input type=text ng-model=item.title><select ng-model=item.content_type><option value=image label=image></option><option value=video label=video></option><option value=note label=note></option><option value=document label=document></option><option value=collection label=collection></option><option value=curation label=curation></option><option value=draft label=draft></option><option value=link label=link></option><option label></option></select><input type=text ng-model=item.data></tab><tab heading=view><content-item content=item></content-item></tab></tabset></li></ul></tab><tab class=ngDialogTab ng-if=!curation.ispublished ng-click=publish(curation.$id) heading=Publish></tab></tabset></div></div>')}])}(window);